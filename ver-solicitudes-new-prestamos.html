<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mis Solicitudes - Sistema de Pr√©stamos</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #1abc9c;
            --primary-dark: #16a085;
            --background-color: #2c3e50;
            --text-color: #ffffff;
            --text-light: #a8a8a8;
            --border-color: #444;
            --card-bg: #34495e;
            --danger-color: #e74c3c;
            --success-color: #15b086;
            --warning-color: #f39c12;
            --info-color: #3498db;
            --gradient-primary: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            --smooth-transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow-x: hidden;
            font-size: 12px;
        }

        body {
            font-family: 'Poppins', 'Roboto', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            min-height: 100vh;
            line-height: 1.4;
            display: flex;
            flex-direction: column;
            padding: 0;
            margin: 0;
        }

        /* HEADER */
        .app-header {
            background: var(--card-bg);
            padding: 0.5rem 0.8rem;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            box-shadow: 0 1px 6px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 50px;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
            gap: 0.4rem;
        }

        .logo {
            width: 28px;
            height: 28px;
            border-radius: 6px;
        }

        .header-title {
            color: var(--primary-color);
            font-size: 0.9rem;
            font-weight: 600;
            margin: 0;
        }

        .notification-bell {
            position: relative;
            cursor: pointer;
            font-size: 1rem;
            color: var(--primary-color);
            padding: 0.4rem;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .notification-count {
            position: absolute;
            top: -3px;
            right: -3px;
            background-color: var(--danger-color);
            color: white;
            font-size: 0.6rem;
            font-weight: bold;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            display: none;
        }

        .notification-count.active {
            display: flex;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* CONTENEDOR PRINCIPAL */
        .container {
            flex: 1;
            width: 100%;
            max-width: 100%;
            padding: 0;
            margin-top: 50px;
            margin-bottom: 60px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .content {
            padding: 0.8rem;
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
        }

        /* CARD */
        .card {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 0.8rem;
            margin-bottom: 0.8rem;
            box-shadow: var(--card-shadow);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: var(--smooth-transition);
            width: 100%;
            box-sizing: border-box;
        }

        .card-title {
            color: var(--primary-color);
            margin-top: 0;
            margin-bottom: 0.8rem;
            font-size: 0.85rem;
            font-weight: 600;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.4rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        /* USER INFO PANEL */
        .user-panel {
            text-align: center;
            padding: 0.8rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, rgba(26, 188, 156, 0.1), rgba(22, 160, 133, 0.1));
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 0.6rem;
            font-size: 1.1rem;
            color: white;
            font-weight: bold;
        }

        .user-name {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 0.2rem;
        }

        .user-email {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-bottom: 0.4rem;
        }

        .login-info {
            font-size: 0.7rem;
            color: var(--primary-color);
            margin-top: 0.4rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.4rem;
        }

        /* FILTER CONTROLS */
        .filter-controls {
            display: flex;
            gap: 0.4rem;
            margin-bottom: 0.8rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            border-radius: 6px;
            padding: 0.4rem 0.6rem;
            cursor: pointer;
            font-size: 0.8rem;
            transition: var(--smooth-transition);
            flex: 1;
            min-width: 70px;
            text-align: center;
        }

        .filter-btn.active {
            background: var(--gradient-primary);
            border-color: var(--primary-color);
        }

        /* APPLICATION LIST */
        .application-list {
            margin-top: 0.8rem;
        }

        .application-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 0.8rem;
            margin-bottom: 0.8rem;
            border-left: 3px solid var(--primary-color);
            transition: var(--smooth-transition);
            animation: fadeIn 0.4s ease;
            border: 1px solid var(--border-color);
        }

        .application-item.new {
            border-left-color: var(--warning-color);
            background: rgba(243, 156, 18, 0.05);
            animation: highlight 0.8s ease;
        }

        @keyframes highlight {
            0% { background-color: rgba(243, 156, 18, 0.2); }
            100% { background-color: rgba(243, 156, 18, 0.05); }
        }

        .application-item.pending {
            border-left-color: var(--warning-color);
        }

        .application-item.approved {
            border-left-color: var(--success-color);
        }

        .application-item.rejected {
            border-left-color: var(--danger-color);
        }

        .application-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.6rem;
            flex-wrap: wrap;
            gap: 0.4rem;
        }

        .application-rtm {
            font-family: monospace;
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--primary-color);
            letter-spacing: 0.5px;
        }

        .application-status {
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            background: rgba(255, 255, 255, 0.1);
        }

        .status-pending {
            background-color: rgba(243, 156, 18, 0.2);
            color: var(--warning-color);
        }

        .status-approved {
            background-color: rgba(46, 204, 113, 0.2);
            color: var(--success-color);
        }

        .status-rejected {
            background-color: rgba(231, 76, 60, 0.2);
            color: var(--danger-color);
        }

        .application-details {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.6rem;
            margin-bottom: 0.8rem;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.3rem 0;
            border-bottom: 1px dashed rgba(255, 255, 255, 0.1);
        }

        .detail-label {
            color: var(--text-light);
            font-size: 0.75rem;
        }

        .detail-value {
            font-weight: 500;
            font-size: 0.8rem;
            text-align: right;
            max-width: 60%;
            word-break: break-word;
        }

        .application-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 0.8rem;
            padding-top: 0.8rem;
            border-top: 1px solid var(--border-color);
            flex-wrap: wrap;
            gap: 0.4rem;
        }

        .application-date {
            font-size: 0.7rem;
            color: var(--text-light);
            display: flex;
            align-items: center;
            gap: 0.4rem;
            flex-wrap: wrap;
        }

        .application-actions {
            display: flex;
            gap: 0.4rem;
            flex-wrap: wrap;
        }

        /* BOTONES */
        .btn {
            background: var(--gradient-primary);
            color: var(--text-color);
            border: none;
            border-radius: 6px;
            padding: 0.5rem 0.7rem;
            cursor: pointer;
            font-size: 0.8rem;
            transition: var(--smooth-transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            font-family: 'Poppins', sans-serif;
            min-height: 32px;
            touch-action: manipulation;
        }

        .btn i {
            margin-right: 4px;
            font-size: 0.8rem;
        }

        .btn-sm {
            padding: 0.3rem 0.6rem;
            font-size: 0.75rem;
            min-height: 28px;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-color), #11946e);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger-color), #c0392b);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning-color), #e67e22);
        }

        .btn-info {
            background: linear-gradient(135deg, var(--info-color), #2980b9);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #7f8c8d, #95a5a6);
        }

        /* MEDIA QUERIES */
        @media (min-width: 481px) and (max-width: 767px) {
            html { font-size: 13px; }
            .container { max-width: 95%; margin-left: auto; margin-right: auto; }
            .application-details { grid-template-columns: 1fr 1fr; }
            .filter-btn { min-width: 80px; }
        }

        @media (min-width: 768px) and (max-width: 1023px) {
            html { font-size: 13px; }
            .container { max-width: 90%; margin-left: auto; margin-right: auto; }
            .content { padding: 1rem; }
            .card { padding: 1rem; }
            .application-details { grid-template-columns: 1fr 1fr; }
            .filter-btn { min-width: 90px; }
        }

        @media (min-width: 1024px) {
            html { font-size: 13px; }
            .container { max-width: 800px; }
            .content { padding: 1rem; }
            .card { padding: 1rem; }
            .application-details { grid-template-columns: 1fr 1fr; }
            .filter-btn { min-width: 100px; }
        }

        @media (max-width: 480px) {
            .application-header { flex-direction: column; gap: 0.4rem; }
            .application-footer { flex-direction: column; align-items: flex-start; gap: 0.8rem; }
            .application-actions { width: 100%; justify-content: space-between; }
            .btn { flex: 1; min-width: 0; }
        }

        @media (max-width: 360px) {
            html { font-size: 11px; }
            .container { padding: 0.6rem; }
            .content { padding: 0.6rem; }
            .card { padding: 0.6rem; }
            .application-actions { flex-direction: column; }
            .btn { width: 100%; }
            .filter-controls { flex-direction: column; }
            .filter-btn { min-width: 100%; }
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <header class="app-header">
        <button class="btn btn-sm" onclick="window.location.href='index.html'" style="background: rgba(255,255,255,0.1); padding: 0.4rem; width: 36px; height: 36px;">
            <i class="fas fa-arrow-left"></i>
        </button>
        <div class="header-content">
            <img src="logo.png" alt="Logo" class="logo" onerror="this.style.display='none'">
            <h1 class="header-title">Mis Solicitudes</h1>
        </div>
        <div class="notification-bell" id="notificationBell" style="display: none;">
            <i class="fas fa-bell"></i>
            <span class="notification-count" id="notificationCount">0</span>
        </div>
    </header>

    <!-- CONTENEDOR PRINCIPAL -->
    <div class="container">
        <div class="content" id="mainContent">
            <!-- CONTENIDO CUANDO NO HAY USUARIO -->
            <div id="noUserSection" style="display: none;">
                <div class="card" style="background: linear-gradient(135deg, rgba(243, 156, 18, 0.1), rgba(231, 76, 60, 0.1)); border: 1px solid var(--warning-color);">
                    <div style="text-align: center; padding: 1.5rem 0.8rem;">
                        <div style="font-size: 2rem; color: var(--warning-color); margin-bottom: 0.8rem;">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <h2 style="color: var(--warning-color); margin-bottom: 0.8rem; font-size: 1rem;">Usuario no identificado</h2>
                        <p style="color: var(--text-light); margin-bottom: 1rem; font-size: 0.85rem;">
                            No hay un usuario identificado en el sistema. Para ver tus solicitudes, 
                            necesitas iniciar sesi√≥n en la p√°gina principal.
                        </p>
                        <p style="color: var(--text-color); font-size: 0.8rem; margin-bottom: 1.5rem;">
                            <i class="fas fa-info-circle"></i> 
                            Solo puedes ver las solicitudes cuando has iniciado sesi√≥n en el sistema.
                        </p>
                        <button class="btn btn-warning" onclick="redirectToIndex()" style="padding: 0.6rem 1.5rem;">
                            <i class="fas fa-sign-in-alt"></i> Ir a Iniciar Sesi√≥n
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- CONTENIDO CUANDO S√ç HAY USUARIO -->
            <div id="requestsSection" style="display: none;">
                <!-- PANEL DE USUARIO -->
                <div class="user-panel" id="userPanel">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <h2 class="user-name" id="userName">Usuario</h2>
                    <p class="user-email" id="userEmail">usuario@ejemplo.com</p>
                    <div class="login-info">
                        <i class="fas fa-user-check"></i>
                        <span>Sesi√≥n activa - Verificando solicitudes...</span>
                    </div>
                    <div style="font-size: 0.7rem; color: var(--text-light); margin-top: 0.4rem;">
                        <i class="fas fa-history"></i> √öltima actualizaci√≥n: <span id="lastUpdate">--:--:--</span>
                    </div>
                    <button class="btn btn-sm" onclick="logout()" style="margin-top: 0.8rem; background: rgba(255,255,255,0.1);">
                        <i class="fas fa-sign-out-alt"></i> Cerrar Sesi√≥n
                    </button>
                </div>

                <!-- CARD PRINCIPAL -->
                <div class="card">
                    <div class="card-title">
                        <span><i class="fas fa-file-invoice-dollar"></i> Mis Solicitudes Recibidas</span>
                        <span id="applicationCount" style="font-size: 0.8rem;">0 solicitudes</span>
                    </div>

                    <!-- CONTROLES DE FILTRO -->
                    <div class="filter-controls">
                        <button class="filter-btn active" data-filter="all">Todas</button>
                        <button class="filter-btn" data-filter="pending">Pendientes</button>
                        <button class="filter-btn" data-filter="approved">Aprobadas</button>
                        <button class="filter-btn" data-filter="rejected">Rechazadas</button>
                    </div>

                    <!-- LISTA DE SOLICITUDES -->
                    <div class="application-list" id="applicationList">
                        <div class="spinner" id="loadingSpinner">
                            <div style="width: 30px; height: 30px; border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 50%; border-top-color: var(--primary-color); animation: spin 1s ease-in-out infinite; margin: 0 auto;"></div>
                            <p style="margin-top: 0.8rem; color: var(--text-light); font-size: 0.85rem;">Cargando solicitudes...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- AUDIO PARA NOTIFICACIONES -->
    <audio id="notificationSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3" type="audio/mpeg">
    </audio>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
        import { 
            getFirestore, 
            collection, 
            query, 
            where, 
            onSnapshot,
            updateDoc,
            doc,
            getDocs,
            getDoc
        } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";

        // Configuraci√≥n de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDLi-egzQlgbKW8XV_qIhU6313Gd8gocCg",
            authDomain: "inventario-35d6b.firebaseapp.com",
            databaseURL: "https://inventario-35d6b-default-rtdb.firebaseio.com",
            projectId: "inventario-35d6b",
            storageBucket: "inventario-35d6b.appspot.com",
            messagingSenderId: "266100399659",
            appId: "1:266100399659:web:92358d28cbd803c8a7d46e"
        };

        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Variables globales
        let currentUser = null;
        let applications = [];
        let filteredApplications = [];
        let unreadCount = 0;
        let unsubscribe = null;
        let sessionTimeout = null;

        // Inicializar - Verificar usuario logueado
        document.addEventListener('DOMContentLoaded', async () => {
            console.log("=== INICIANDO VERIFICACI√ìN DE SESI√ìN ===");
            
            // Mostrar mensaje de carga
            showLoadingMessage();
            
            try {
                // Intentar obtener usuario de localStorage
                const savedUser = localStorage.getItem('loanSystemUser');
                
                if (!savedUser) {
                    console.log("‚ùå No hay usuario en localStorage");
                    setTimeout(() => {
                        showNoUserSection();
                        hideLoadingMessage();
                    }, 500);
                    return;
                }
                
                console.log("‚úÖ Usuario encontrado en localStorage");
                currentUser = JSON.parse(savedUser);
                
                // Verificar datos m√≠nimos del usuario
                if (!currentUser || !currentUser.id || !currentUser.email) {
                    console.log("‚ùå Datos de usuario incompletos en localStorage");
                    localStorage.removeItem('loanSystemUser');
                    currentUser = null;
                    setTimeout(() => {
                        showNoUserSection();
                        hideLoadingMessage();
                    }, 500);
                    return;
                }
                
                console.log("üë§ Usuario del localStorage:", {
                    id: currentUser.id,
                    email: currentUser.email,
                    name: currentUser.name
                });
                
                // Verificar que el usuario exista en Firebase
                try {
                    console.log("üîç Verificando usuario en Firebase...");
                    const userDocRef = doc(db, "users", currentUser.id);
                    const userDocSnap = await getDoc(userDocRef);
                    
                    if (userDocSnap.exists()) {
                        console.log("‚úÖ Usuario verificado en Firebase");
                        const userData = userDocSnap.data();
                        
                        // Actualizar datos del usuario desde Firebase
                        currentUser = {
                            id: currentUser.id,
                            email: userData.email || currentUser.email,
                            name: userData.name || userData.username || currentUser.name || 'Usuario',
                            username: userData.username || currentUser.username || '',
                            phone: userData.phone || currentUser.phone || '',
                            pin: userData.pin || currentUser.pin || ''
                        };
                        
                        // Actualizar localStorage con datos actualizados
                        localStorage.setItem('loanSystemUser', JSON.stringify(currentUser));
                        
                        console.log("üîÑ Usuario actualizado:", currentUser);
                        
                        // Iniciar sesi√≥n exitosamente
                        setTimeout(() => {
                            startSession();
                            hideLoadingMessage();
                        }, 500);
                        
                    } else {
                        console.log("‚ùå Usuario no existe en Firebase");
                        localStorage.removeItem('loanSystemUser');
                        currentUser = null;
                        setTimeout(() => {
                            showNoUserSection();
                            hideLoadingMessage();
                        }, 500);
                    }
                    
                } catch (firebaseError) {
                    console.error("‚ö†Ô∏è Error verificando usuario en Firebase:", firebaseError);
                    
                    // Si hay error en Firebase pero tenemos datos v√°lidos, intentar usar los datos de localStorage
                    if (currentUser && currentUser.id && currentUser.email) {
                        console.log("‚ö†Ô∏è Usando datos de localStorage por error en Firebase");
                        setTimeout(() => {
                            startSession();
                            hideLoadingMessage();
                        }, 500);
                    } else {
                        localStorage.removeItem('loanSystemUser');
                        currentUser = null;
                        setTimeout(() => {
                            showNoUserSection();
                            hideLoadingMessage();
                        }, 500);
                    }
                }
                
            } catch (error) {
                console.error("‚ùå Error al cargar usuario de localStorage:", error);
                localStorage.removeItem('loanSystemUser');
                currentUser = null;
                setTimeout(() => {
                    showNoUserSection();
                    hideLoadingMessage();
                }, 500);
            }
        });

        // Mostrar mensaje de carga
        function showLoadingMessage() {
            const content = document.getElementById('mainContent');
            if (content) {
                content.innerHTML = `
                    <div style="text-align: center; padding: 3rem 1rem;">
                        <div style="width: 50px; height: 50px; border: 3px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: var(--primary-color); animation: spin 1s linear infinite; margin: 0 auto 1.5rem;"></div>
                        <h3 style="color: var(--primary-color); margin-bottom: 1rem;">Verificando sesi√≥n...</h3>
                        <p style="color: var(--text-light); font-size: 0.9rem;">Espera un momento mientras verificamos tu sesi√≥n</p>
                    </div>
                `;
            }
        }

        // Ocultar mensaje de carga
        function hideLoadingMessage() {
            // La funci√≥n de inicio de sesi√≥n ya maneja la visualizaci√≥n
        }

        // Mostrar secci√≥n cuando NO hay usuario
        function showNoUserSection() {
            console.log("üëÅÔ∏è Mostrando secci√≥n 'no hay usuario'");
            document.getElementById('noUserSection').style.display = 'block';
            document.getElementById('requestsSection').style.display = 'none';
            document.getElementById('notificationBell').style.display = 'none';
        }

        // Mostrar secci√≥n cuando S√ç hay usuario
        function showRequestsSection() {
            console.log("üëÅÔ∏è Mostrando secci√≥n de solicitudes");
            document.getElementById('noUserSection').style.display = 'none';
            document.getElementById('requestsSection').style.display = 'block';
            document.getElementById('notificationBell').style.display = 'block';
        }

        // Redirigir a index.html
        function redirectToIndex() {
            console.log("üîó Redirigiendo a p√°gina principal");
            window.location.href = 'index.html';
        }

        // Iniciar sesi√≥n (cuando hay usuario verificado)
        function startSession() {
            if (!currentUser) {
                console.error("‚ùå No hay usuario para iniciar sesi√≥n");
                showNoUserSection();
                return;
            }
            
            console.log("üöÄ Iniciando sesi√≥n para:", currentUser.email);
            
            // Mostrar secci√≥n de solicitudes
            showRequestsSection();
            
            // Actualizar informaci√≥n del usuario
            updateUserPanel();
            
            // Mostrar mensaje de bienvenida
            showWelcomeNotification();
            
            // Cargar solicitudes en tiempo real
            loadApplicationsRealtime();
            
            // Configurar controles de filtro
            setupFilters();
            
            // Configurar actualizaci√≥n de tiempo
            updateLastUpdateTime();
            setInterval(updateLastUpdateTime, 1000);
            
            // Configurar timeout de sesi√≥n (24 horas)
            if (sessionTimeout) clearTimeout(sessionTimeout);
            sessionTimeout = setTimeout(() => {
                console.log("‚è∞ Sesi√≥n expirada por inactividad");
                showSessionExpiredNotification();
                logout();
            }, 24 * 60 * 60 * 1000); // 24 horas
        }

        // Mostrar notificaci√≥n de bienvenida
        function showWelcomeNotification() {
            const userName = currentUser.name || currentUser.email.split('@')[0] || 'Usuario';
            const notificationHTML = `
                <div style="position: fixed; top: 60px; left: 50%; transform: translateX(-50%); background: var(--primary-color); color: white; padding: 0.8rem 1.2rem; border-radius: 8px; font-weight: 500; z-index: 2000; box-shadow: 0 4px 15px rgba(26, 188, 156, 0.3); animation: slideDown 0.5s ease; max-width: 90%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                    <i class="fas fa-check-circle"></i> ¬°Bienvenido de nuevo, ${userName}!
                </div>
            `;
            
            const notification = document.createElement('div');
            notification.innerHTML = notificationHTML;
            document.body.appendChild(notification.firstElementChild);
            
            setTimeout(() => {
                if (notification.firstElementChild && notification.firstElementChild.parentNode) {
                    notification.firstElementChild.parentNode.removeChild(notification.firstElementChild);
                }
            }, 3000);
        }

        // Mostrar notificaci√≥n de sesi√≥n expirada
        function showSessionExpiredNotification() {
            const notificationHTML = `
                <div style="position: fixed; top: 60px; left: 50%; transform: translateX(-50%); background: var(--warning-color); color: white; padding: 0.8rem 1.2rem; border-radius: 8px; font-weight: 500; z-index: 2000; box-shadow: 0 4px 15px rgba(243, 156, 18, 0.3); animation: slideDown 0.5s ease; max-width: 90%;">
                    <i class="fas fa-exclamation-triangle"></i> Tu sesi√≥n ha expirado, por favor inicia sesi√≥n nuevamente
                </div>
            `;
            
            const notification = document.createElement('div');
            notification.innerHTML = notificationHTML;
            document.body.appendChild(notification.firstElementChild);
            
            setTimeout(() => {
                if (notification.firstElementChild && notification.firstElementChild.parentNode) {
                    notification.firstElementChild.parentNode.removeChild(notification.firstElementChild);
                }
            }, 5000);
        }

        // Cerrar sesi√≥n
        function logout() {
            console.log("üëã Cerrando sesi√≥n...");
            
            // Detener listener actual
            if (unsubscribe) {
                unsubscribe();
                unsubscribe = null;
            }
            
            // Limpiar datos
            currentUser = null;
            applications = [];
            filteredApplications = [];
            unreadCount = 0;
            
            // Limpiar localStorage
            localStorage.removeItem('loanSystemUser');
            
            // Limpiar timeout de sesi√≥n
            if (sessionTimeout) {
                clearTimeout(sessionTimeout);
                sessionTimeout = null;
            }
            
            // Mostrar secci√≥n de "no hay usuario"
            showNoUserSection();
            
            // Mostrar mensaje de despedida
            showLogoutNotification();
        }

        // Mostrar notificaci√≥n de cierre de sesi√≥n
        function showLogoutNotification() {
            const notificationHTML = `
                <div style="position: fixed; top: 60px; left: 50%; transform: translateX(-50%); background: var(--info-color); color: white; padding: 0.8rem 1.2rem; border-radius: 8px; font-weight: 500; z-index: 2000; box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3); animation: slideDown 0.5s ease; max-width: 90%;">
                    <i class="fas fa-sign-out-alt"></i> Sesi√≥n cerrada correctamente
                </div>
            `;
            
            const notification = document.createElement('div');
            notification.innerHTML = notificationHTML;
            document.body.appendChild(notification.firstElementChild);
            
            setTimeout(() => {
                if (notification.firstElementChild && notification.firstElementChild.parentNode) {
                    notification.firstElementChild.parentNode.removeChild(notification.firstElementChild);
                }
            }, 3000);
        }

        // Actualizar panel de usuario
        function updateUserPanel() {
            if (!currentUser) return;
            
            const userName = currentUser.name || currentUser.email.split('@')[0] || 'Usuario';
            const userEmail = currentUser.email || 'Sin email';
            
            document.getElementById('userName').textContent = userName;
            document.getElementById('userEmail').textContent = userEmail;
            
            const avatar = document.getElementById('userAvatar');
            const initials = getInitials(userName);
            avatar.textContent = initials;
            
            const colors = ['#1abc9c', '#3498db', '#9b59b6', '#e74c3c', '#f39c12', '#2ecc71'];
            const colorIndex = Math.abs(hashCode(userEmail || currentUser.id)) % colors.length;
            avatar.style.background = `linear-gradient(135deg, ${colors[colorIndex]}, ${darkenColor(colors[colorIndex], 20)})`;
            
            // Actualizar t√≠tulo de la p√°gina con el nombre del usuario
            document.title = `Mis Solicitudes - ${userName}`;
        }

        // Configurar filtros
        function setupFilters() {
            const filterButtons = document.querySelectorAll('.filter-btn');
            filterButtons.forEach(button => {
                button.addEventListener('click', () => {
                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    const filter = button.getAttribute('data-filter');
                    filterApplications(filter);
                });
            });
        }

        // Cargar aplicaciones en tiempo real
        async function loadApplicationsRealtime() {
            try {
                if (!currentUser || !currentUser.id) {
                    console.error("‚ùå No hay usuario identificado");
                    showNoUserSection();
                    return;
                }
                
                console.log("üì° Escuchando solicitudes para el usuario:", currentUser.id);
                
                const applicationsRef = collection(db, "LoanApplications");
                
                // Crear array de consultas posibles
                const queryAttempts = [
                    query(applicationsRef, where("userId", "==", currentUser.id)),
                    query(applicationsRef, where("targetUserId", "==", currentUser.id)),
                    query(applicationsRef, where("assignedTo", "==", currentUser.id)),
                    query(applicationsRef, where("assignedToEmail", "==", currentUser.email)),
                    query(applicationsRef, where("userEmail", "==", currentUser.email))
                ];
                
                let querySuccess = false;
                
                // Intentar cada consulta
                for (let i = 0; i < queryAttempts.length; i++) {
                    try {
                        console.log(`üîç Intentando consulta ${i + 1}...`);
                        
                        unsubscribe = onSnapshot(queryAttempts[i], (snapshot) => {
                            handleApplicationsSnapshot(snapshot);
                        }, (error) => {
                            console.log(`‚ùå Consulta ${i + 1} fall√≥:`, error.message);
                            
                            // Si es la √∫ltima consulta y fall√≥, intentar cargar todas
                            if (i === queryAttempts.length - 1) {
                                console.log("üîÑ Intentando cargar todas las solicitudes...");
                                const allQuery = query(applicationsRef);
                                
                                unsubscribe = onSnapshot(allQuery, (allSnapshot) => {
                                    const userApplications = [];
                                    allSnapshot.forEach((doc) => {
                                        const data = doc.data();
                                        
                                        // Filtrar manualmente las que son para este usuario
                                        if (data.userId === currentUser.id || 
                                            data.targetUserId === currentUser.id ||
                                            data.assignedTo === currentUser.id ||
                                            data.assignedToEmail === currentUser.email ||
                                            data.userEmail === currentUser.email) {
                                            userApplications.push({
                                                id: doc.id,
                                                ...data
                                            });
                                        }
                                    });
                                    
                                    // Crear snapshot simulado
                                    const simulatedSnapshot = {
                                        docs: userApplications.map(app => ({
                                            id: app.id,
                                            data: () => {
                                                const { id, ...data } = app;
                                                return data;
                                            }
                                        })),
                                        empty: userApplications.length === 0,
                                        forEach: (callback) => {
                                            userApplications.forEach((app, index) => {
                                                callback({
                                                    id: app.id,
                                                    data: () => {
                                                        const { id, ...data } = app;
                                                        return data;
                                                    }
                                                }, index);
                                            });
                                        }
                                    };
                                    
                                    handleApplicationsSnapshot(simulatedSnapshot);
                                }, (allError) => {
                                    console.error("‚ùå Error cargando todas las solicitudes:", allError);
                                    handleSnapshotError(allError);
                                });
                            }
                        });
                        
                        querySuccess = true;
                        console.log(`‚úÖ Consulta ${i + 1} configurada exitosamente`);
                        break;
                        
                    } catch (queryError) {
                        console.log(`‚ö†Ô∏è Consulta ${i + 1} gener√≥ error:`, queryError.message);
                        continue;
                    }
                }
                
                if (!querySuccess) {
                    console.log("‚ùå Todas las consultas fallaron");
                    showEmptyState();
                }
                
            } catch (error) {
                console.error("‚ùå Error al configurar listener en tiempo real:", error);
                handleSnapshotError(error);
            }
        }

        // Manejar snapshot de aplicaciones
        function handleApplicationsSnapshot(snapshot) {
            try {
                console.log(`üìä Datos recibidos: ${snapshot.docs ? snapshot.docs.length : 0} documentos`);
                
                // Ocultar spinner de carga
                const loadingSpinner = document.getElementById('loadingSpinner');
                if (loadingSpinner) {
                    loadingSpinner.style.display = 'none';
                }
                
                const newApplications = [];
                const oldAppIds = applications.map(app => app.id);
                
                // Procesar documentos
                if (snapshot.forEach) {
                    snapshot.forEach((doc) => {
                        try {
                            let data, id;
                            
                            if (typeof doc.data === 'function') {
                                data = doc.data();
                                id = doc.id;
                            } else {
                                data = doc;
                                id = doc.id;
                            }
                            
                            if (data) {
                                // Generar RTM √∫nico si no existe
                                if (!data.rtmNumber || data.rtmNumber === 'RTM-00000000') {
                                    data.rtmNumber = generateUniqueRTM();
                                }
                                
                                newApplications.push({
                                    id: id || generateUniqueId(),
                                    ...data
                                });
                            }
                        } catch (docError) {
                            console.error("‚ùå Error procesando documento:", docError);
                        }
                    });
                }
                
                // Detectar nuevas solicitudes
                const newApps = newApplications.filter(app => !oldAppIds.includes(app.id));
                
                // Marcar nuevas solicitudes como no le√≠das
                newApps.forEach(app => {
                    app.isNew = true;
                    app.isRead = false;
                    handleNewApplication(app);
                });
                
                // Actualizar lista completa
                applications = newApplications;
                
                // Ordenar por fecha (m√°s recientes primero)
                applications.sort((a, b) => {
                    try {
                        let dateA = getDateFromApplication(a);
                        let dateB = getDateFromApplication(b);
                        return dateB - dateA;
                    } catch (error) {
                        return 0;
                    }
                });
                
                // Actualizar UI
                updateCounters();
                const activeFilter = document.querySelector('.filter-btn.active');
                if (activeFilter) {
                    filterApplications(activeFilter.getAttribute('data-filter'));
                } else {
                    filterApplications('all');
                }
                
                // Mostrar estado vac√≠o si no hay aplicaciones
                if (applications.length === 0) {
                    showEmptyState();
                }
                
            } catch (error) {
                console.error("‚ùå Error en handleApplicationsSnapshot:", error);
            }
        }

        // Obtener fecha de una aplicaci√≥n
        function getDateFromApplication(app) {
            if (app.applicationDate && app.applicationDate.toDate) {
                return app.applicationDate.toDate();
            } else if (app.applicationDate) {
                return new Date(app.applicationDate);
            } else if (app.createdAt) {
                return new Date(app.createdAt);
            } else if (app.timestamp) {
                return new Date(app.timestamp);
            } else {
                return new Date(0);
            }
        }

        // Manejar error en snapshot
        function handleSnapshotError(error) {
            console.error("‚ùå Error en listener:", error);
            const loadingSpinner = document.getElementById('loadingSpinner');
            if (loadingSpinner) {
                loadingSpinner.innerHTML = `
                    <div style="color: var(--danger-color); text-align: center;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 1.5rem; margin-bottom: 0.8rem;"></i>
                        <p style="font-size: 0.9rem;">Error al cargar solicitudes</p>
                        <p style="font-size: 0.8rem; margin-top: 0.4rem; color: var(--text-light);">
                            ${error.message || 'Error desconocido'}
                        </p>
                        <button class="btn" onclick="location.reload()" style="margin-top: 0.8rem; padding: 0.5rem 1rem;">
                            <i class="fas fa-redo"></i> Reintentar
                        </button>
                    </div>
                `;
            }
        }

        // Mostrar estado vac√≠o
        function showEmptyState() {
            const applicationList = document.getElementById('applicationList');
            if (applicationList) {
                applicationList.innerHTML = `
                    <div style="text-align: center; padding: 2rem 0.8rem; color: var(--text-light);">
                        <div style="font-size: 2rem; color: var(--border-color); margin-bottom: 0.8rem;">
                            <i class="fas fa-inbox"></i>
                        </div>
                        <h3 style="color: var(--text-color); margin-bottom: 0.4rem; font-size: 0.95rem;">No hay solicitudes a√∫n</h3>
                        <p style="font-size: 0.85rem;">No has recibido solicitudes de pr√©stamo todav√≠a.</p>
                        <p style="font-size: 0.8rem; margin-top: 0.8rem; color: var(--primary-color);">
                            <i class="fas fa-info-circle"></i> Las solicitudes aparecer√°n aqu√≠ cuando alguien te env√≠e una.
                        </p>
                    </div>
                `;
            }
        }

        // Manejar nueva solicitud
        function handleNewApplication(application) {
            // Incrementar contador de no le√≠das
            unreadCount++;
            
            // Actualizar contador de notificaciones
            updateCounters();
            
            // Mostrar notificaci√≥n visual
            showNewRequestNotification(application);
            
            // Vibraci√≥n si est√° disponible (para m√≥viles)
            if (navigator.vibrate) {
                navigator.vibrate([200, 100, 200]);
            }
        }

        // Mostrar notificaci√≥n de nueva solicitud
        function showNewRequestNotification(application) {
            const applicantName = application.applicantName || 'Un solicitante';
            const rtmNumber = application.rtmNumber || generateUniqueRTM();
            
            const notificationHTML = `
                <div style="position: fixed; top: 60px; left: 50%; transform: translateX(-50%); background: var(--warning-color); color: white; padding: 0.8rem 1.2rem; border-radius: 8px; font-weight: 500; z-index: 2000; box-shadow: 0 4px 15px rgba(243, 156, 18, 0.3); animation: slideDown 0.5s ease; max-width: 90%;">
                    <i class="fas fa-bell"></i> ¬°Nueva solicitud de ${applicantName} - ${rtmNumber}
                </div>
            `;
            
            const notification = document.createElement('div');
            notification.innerHTML = notificationHTML;
            document.body.appendChild(notification.firstElementChild);
            
            setTimeout(() => {
                if (notification.firstElementChild && notification.firstElementChild.parentNode) {
                    notification.firstElementChild.parentNode.removeChild(notification.firstElementChild);
                }
            }, 5000);
        }

        // Generar ID √∫nico
        function generateUniqueId() {
            return 'app_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        // Generar RTM √∫nico
        function generateUniqueRTM() {
            const timestamp = Date.now().toString();
            const random = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
            const uniquePart = (timestamp.slice(-4) + random).padStart(8, '0');
            return `RTM-${uniquePart}`;
        }

        // Filtrar aplicaciones por estado
        function filterApplications(filterType) {
            let filtered = [];
            
            switch(filterType) {
                case 'all':
                    filtered = [...applications];
                    break;
                case 'pending':
                    filtered = applications.filter(app => 
                        (app.status || '').toLowerCase().includes('pendiente'));
                    break;
                case 'approved':
                    filtered = applications.filter(app => 
                        (app.status || '').toLowerCase().includes('aprob'));
                    break;
                case 'rejected':
                    filtered = applications.filter(app => 
                        (app.status || '').toLowerCase().includes('rechaz'));
                    break;
                default:
                    filtered = [...applications];
            }
            
            filteredApplications = filtered;
            renderApplications();
        }

        // Renderizar aplicaciones en la lista
        function renderApplications() {
            const applicationList = document.getElementById('applicationList');
            if (!applicationList) return;
            
            if (filteredApplications.length === 0) {
                const activeFilter = document.querySelector('.filter-btn.active');
                const filterType = activeFilter ? activeFilter.getAttribute('data-filter') : 'all';
                
                let message = '';
                let icon = 'fas fa-inbox';
                
                switch(filterType) {
                    case 'all':
                        message = 'No tienes solicitudes de pr√©stamo.';
                        icon = 'fas fa-inbox';
                        break;
                    case 'pending':
                        message = 'No tienes solicitudes pendientes.';
                        icon = 'fas fa-clock';
                        break;
                    case 'approved':
                        message = 'No tienes solicitudes aprobadas.';
                        icon = 'fas fa-check-circle';
                        break;
                    case 'rejected':
                        message = 'No tienes solicitudes rechazadas.';
                        icon = 'fas fa-times-circle';
                        break;
                }
                
                applicationList.innerHTML = `
                    <div style="text-align: center; padding: 2rem 0.8rem; color: var(--text-light);">
                        <div style="font-size: 2rem; color: var(--border-color); margin-bottom: 0.8rem;">
                            <i class="${icon}"></i>
                        </div>
                        <h3 style="color: var(--text-color); margin-bottom: 0.4rem; font-size: 0.95rem;">No hay solicitudes ${getFilterText()}</h3>
                        <p style="font-size: 0.85rem;">${message}</p>
                        ${filterType !== 'all' ? 
                            `<button class="btn" onclick="document.querySelector('[data-filter=\"all\"]').click()" style="margin-top: 0.8rem; padding: 0.5rem 1rem;">
                                <i class="fas fa-eye"></i> Ver todas las solicitudes
                            </button>` : ''
                        }
                    </div>
                `;
                return;
            }
            
            applicationList.innerHTML = '';
            
            filteredApplications.forEach((app, index) => {
                const applicationItem = createApplicationElement(app);
                applicationList.appendChild(applicationItem);
                
                // Animaci√≥n de entrada escalonada
                setTimeout(() => {
                    if (applicationItem.classList) {
                        applicationItem.style.opacity = '1';
                        applicationItem.style.transform = 'translateY(0)';
                    }
                }, index * 50);
            });
        }

        // Crear elemento de aplicaci√≥n
        function createApplicationElement(app) {
            const div = document.createElement('div');
            div.className = `application-item ${getStatusClass(app.status)} ${app.isNew && !app.isRead ? 'new' : ''}`;
            div.id = `app-${app.id || generateUniqueId()}`;
            div.style.opacity = '0';
            div.style.transform = 'translateY(10px)';
            div.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
            
            let dateString = 'Fecha no disponible';
            try {
                const date = getDateFromApplication(app);
                if (date.getTime() > 0) {
                    dateString = date.toLocaleDateString('es-ES', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                }
            } catch (error) {
                console.error("Error formateando fecha:", error);
            }
            
            let amountFormatted = '$0';
            try {
                if (app.loanAmount) {
                    const amount = parseFloat(app.loanAmount);
                    if (!isNaN(amount)) {
                        amountFormatted = `$${amount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                    }
                }
            } catch (error) {
                console.error("Error formateando monto:", error);
            }
            
            let statusText = 'Pendiente';
            let statusClass = 'status-pending';
            
            const status = (app.status || '').toLowerCase();
            if (status.includes('aprob')) {
                statusText = 'Aprobado';
                statusClass = 'status-approved';
            } else if (status.includes('rechaz')) {
                statusText = 'Rechazado';
                statusClass = 'status-rejected';
            }
            
            let rtmNumber = app.rtmNumber || generateUniqueRTM();
            const appId = (app.id || '').replace(/"/g, '&quot;').replace(/'/g, '&#x27;');
            
            const isPending = status.includes('pendiente');
            const isApproved = status.includes('aprob');
            const isRejected = status.includes('rechaz');
            const isNew = app.isNew && !app.isRead;
            
            div.innerHTML = `
                <div class="application-header">
                    <div class="application-rtm">${rtmNumber}</div>
                    <div class="application-status ${statusClass}">${statusText}</div>
                </div>
                
                <div class="application-details">
                    <div class="detail-item">
                        <span class="detail-label">Solicitante:</span>
                        <span class="detail-value">${app.applicantName || 'No especificado'}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Monto:</span>
                        <span class="detail-value">${amountFormatted}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">C√©dula:</span>
                        <span class="detail-value">${app.applicantCedula || 'No especificada'}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Tel√©fono:</span>
                        <span class="detail-value">${app.applicantPhone || 'No especificado'}</span>
                    </div>
                </div>
                
                <div class="application-footer">
                    <div class="application-date">
                        <i class="far fa-clock"></i> ${dateString}
                        ${isNew ? '<span style="background: var(--warning-color); color: white; padding: 0.1rem 0.3rem; border-radius: 8px; font-size: 0.6rem; font-weight: 600; margin-left: 0.3rem; display: inline-flex; align-items: center; gap: 0.1rem;"><i class="fas fa-star"></i> Nuevo</span>' : ''}
                    </div>
                    
                    <div class="application-actions">
                        <button class="btn btn-info btn-sm" onclick="viewApplicationDetails('${appId}')" title="Ver detalles">
                            <i class="fas fa-eye"></i> Ver
                        </button>
                    </div>
                </div>
            `;
            
            return div;
        }

        // Obtener clase CSS para el estado
        function getStatusClass(status) {
            const statusLower = (status || '').toLowerCase();
            if (statusLower.includes('aprob')) return 'approved';
            if (statusLower.includes('rechaz')) return 'rejected';
            if (statusLower.includes('pendiente')) return 'pending';
            return 'pending';
        }

        // Ver detalles de aplicaci√≥n (funci√≥n simplificada para este ejemplo)
        function viewApplicationDetails(applicationId) {
            alert('Funci√≥n de ver detalles - Para implementar completamente');
        }

        // Actualizar contadores
        function updateCounters() {
            try {
                // Contador total
                const appCountElement = document.getElementById('applicationCount');
                if (appCountElement) {
                    appCountElement.textContent = 
                        `${applications.length} solicitud${applications.length !== 1 ? 'es' : ''}`;
                }
                
                // Contador de notificaciones
                const notificationCount = document.getElementById('notificationCount');
                if (notificationCount) {
                    if (unreadCount > 0) {
                        notificationCount.textContent = unreadCount > 99 ? '99+' : unreadCount;
                        notificationCount.classList.add('active');
                    } else {
                        notificationCount.classList.remove('active');
                    }
                }
                
            } catch (error) {
                console.error("Error actualizando contadores:", error);
            }
        }

        // Actualizar tiempo de √∫ltima actualizaci√≥n
        function updateLastUpdateTime() {
            try {
                const element = document.getElementById('lastUpdate');
                if (element) {
                    const now = new Date();
                    const timeString = now.toLocaleTimeString('es-ES', {
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit'
                    });
                    element.textContent = timeString;
                }
            } catch (error) {
                console.error("Error actualizando tiempo:", error);
            }
        }

        // Funciones auxiliares
        function getInitials(name) {
            if (!name) return 'U';
            return name
                .split(' ')
                .map(part => part.charAt(0))
                .join('')
                .toUpperCase()
                .substring(0, 2);
        }

        function hashCode(str) {
            if (!str) return 0;
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                hash = str.charCodeAt(i) + ((hash << 5) - hash);
            }
            return hash;
        }

        function darkenColor(color, percent) {
            if (!color) return '#1abc9c';
            const num = parseInt(color.replace("#", ""), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) - amt;
            const G = (num >> 8 & 0x00FF) - amt;
            const B = (num & 0x0000FF) - amt;
            return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
                (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
                (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
        }

        function getFilterText() {
            const activeFilter = document.querySelector('.filter-btn.active');
            if (!activeFilter) return '';
            
            const filter = activeFilter.getAttribute('data-filter');
            const filters = {
                'all': '',
                'pending': 'pendientes',
                'approved': 'aprobadas',
                'rejected': 'rechazadas'
            };
            return filters[filter];
        }

        // Hacer funciones globales para los event listeners
        window.redirectToIndex = redirectToIndex;
        window.logout = logout;
        window.viewApplicationDetails = viewApplicationDetails;

        // Agregar animaci√≥n CSS para slideDown
        const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                to { transform: rotate(360deg); }
            }
            @keyframes slideDown {
                from { top: 0; opacity: 0; }
                to { top: 60px; opacity: 1; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
